#!/bin/sh
# send files with mconnect

PATH=$PATH:$HOME/.local/bin
msg() { notify-send "MConnect Send" "$1"; }

{ mconnectctl list-devices || msg "Mconnect not installed"; } |
grep /org/mconnect/device |
while read -r device _ _ name; do
    if mconnectctl show-device "$device" | grep -iq "connected:\s*true"; then
        echo "$device $name"
    fi
done |
{ dmenu -p "Send those files to" || notify-send "dmenu failed"; } |
{   read -r device _
    if [ -z "$device" ]; then
        msg "No devices found/selected"
        exit 1
    fi
    echo "$NEMO_SCRIPT_SELECTED_FILE_PATHS" |
    while read -r file; do
        if [ -n "$file" ]; then
            msg "Sending $file"
            mconnectctl share-file "$device" "$file"
        fi
    done
}
